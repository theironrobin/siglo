#!@PYTHON@


import os
import sys
import signal
import gettext
import argparse
import dbus

from dbus.mainloop.glib import DBusGMainLoop
from gi.repository import GLib

VERSION = '@VERSION@'
pkgdatadir = '@pkgdatadir@'
localedir = '@localedir@'

sys.path.insert(1, pkgdatadir)
signal.signal(signal.SIGINT, signal.SIG_DFL)
gettext.install('siglo', localedir)

from siglo import daemon

def main():
    p = argparse.ArgumentParser(description="app to sync InfiniTime watch")
    p.add_argument('--daemon', '-d', required=False, action='store_true', help="start daemon")
    args = p.parse_args()
    
    from siglo import config
    config = config.config()
    config.load_defaults()
    #sys.exit(daemon.main())
    if args.daemon:
        sys.exit(daemon.main())
    else:
        import gi

        from gi.repository import Gio
        resource = Gio.Resource.load(os.path.join(pkgdatadir, 'siglo.gresource'))
        resource._register()

        from siglo import main
        sys.exit(main.main(VERSION))

if __name__ == '__main__':
    main()

